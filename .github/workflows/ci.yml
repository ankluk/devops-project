# This is the name of our workflow, which you'll see on GitHub
name: CI Pipeline (Lint & Test)

# This 'on' block defines the TRIGGER.
on:
  # This workflow will ONLY run when a Pull Request is
  # created or updated that targets the 'main' branch.
  pull_request:
    branches: [ main ]

# 'jobs' holds all the tasks to run.
jobs:
  # We're defining a single job called 'build-and-test'
  build-and-test:
    # This job will run on a fresh virtual machine hosted by GitHub
    runs-on: ubuntu-latest

    # 'steps' are the individual commands to run, in order.
    steps:
      # Step 1: Checks out your repository code onto the runner
      - name: 1. Checkout Code
        uses: actions/checkout@v4

      # Step 2: Installs the Python version we want
      - name: 2. Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Should match our Dockerfile

      # Step 3: Install all our project's libraries
      - name: 3. Install Dependencies
        run: |
          pip install -r requirements.txt
          
      # Step 4: Run the Linter (Code Style Check)
      # If this fails, the whole pipeline fails!
      - name: 4. Run Linter
        run: |
          flake8 . --count --statistics
          
      # Step 5: Run the Unit Tests
      # This is our automated safety check.
      # If this fails, the PR will be blocked.
      - name: 5. Run Unit Tests
        run: |
          pytest
